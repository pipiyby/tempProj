"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");var fs=_interopRequireWildcard(require("fs"));var path=_interopRequireWildcard(require("path"));var http=_interopRequireWildcard(require("http"));var swaggerTools=_interopRequireWildcard(require("swagger-tools"));var jsyaml=_interopRequireWildcard(require("js-yaml"));var httpStatusCodes=_interopRequireWildcard(require("http-status"));var winston=_interopRequireWildcard(require("winston"));var _v=_interopRequireDefault(require("uuid/v4"));var _helper=require("./utils/helper");var _config=require("./utils/config");var _connect=_interopRequireDefault(require("connect"));require("./database");// Get ip address and port for client details
//get ipAddress and port
var _getIpAddressAndPort=(0,_helper.getIpAddressAndPort)(),ipAddress=_getIpAddressAndPort.ipAddress,port=_getIpAddressAndPort.port;// Set App Name
global.apiName=process.env.API_NAME;global.apiVersion=process.env.API_VERSION;//**********************************************
//
// Set up Logger
//
//**********************************************
var metaData=winston.format(function(info){info.applicationName=global.apiName;info.applicationVersion=global.apiVersion;info.environment=process.env.ENVIRONMENT;return info});var logger=winston.createLogger({level:process.env.LOG_LEVEL,transports:[// Log to console
new winston.transports.Console({name:"console",json:true,level:process.env.LOG_LEVEL})],format:winston.format.combine(winston.format.timestamp(),metaData(),winston.format.json())});global.logger=logger;//**********************************************
//
// Check configuration before starting the server
//
//**********************************************
if(!(0,_config.checkConfiguration)()){process.exit(1)}else{global.logger.info("All configurations are available to start the server",{operationName:"createServer"})}//**********************************************
//
// Create database connection
//
//**********************************************
//**********************************************
//
// Setup global variables for the entire application
//
//**********************************************
global.httpStatusCodes=httpStatusCodes;global.serviceUptime=new Date;global.certificate=process.env.JWT_CERTIFICATE;//**********************************************
//
// Start Server
//
//**********************************************
var app=(0,_connect["default"])();// swaggerRouter configuration
var options={swaggerUi:path.join(__dirname,"/swagger.json"),controllers:path.join(__dirname,"./controllers"),useStubs:process.env.STUB};// The Swagger document (require it, build it programmatically, fetch it from a URL, ...)
var spec=fs.readFileSync(path.join(__dirname,"api/swagger.yaml"),"utf8");var swaggerDoc=jsyaml.safeLoad(spec);var contextPath=process.env.CONTEXT_PATH;var uiOptions={apiDocs:contextPath+"/swagger",swaggerUi:contextPath+"/docs"};// Initialize the Swagger middleware
swaggerTools.initializeMiddleware(swaggerDoc,function(middleware){// Interpret Swagger resources and attach metadata to request - must be first in swagger-tools middleware chain
app.use(middleware.swaggerMetadata());// Validate Swagger requests
app.use(middleware.swaggerValidator());// Route validated requests to appropriate controller
app.use(middleware.swaggerRouter(options));// Serve the Swagger documents and Swagger UI
app.use(middleware.swaggerUi(uiOptions));// eslint-disable-next-line no-unused-vars
app.use(function(err,req,res,next){if(err){var transactionId=(0,_v["default"])();var correlationId;if(req.swagger.params["correlationId"]){correlationId=req.swagger.params["correlationId"].value;res.setHeader("correlationId",correlationId?correlationId:"")}res.statusCode=httpStatusCodes.BAD_REQUEST;res.setHeader("transactionId",transactionId);res.setHeader("Content-Type","application/json");logger.log("error","Input request validation failed",{operationId:"defaultServerError",transactionId:transactionId,correlationId:correlationId,stackTrace:err});var error={code:10001,message:err.message,fields:[]};res.end(JSON.stringify(error))}});// Start the server
http.createServer(app).listen(port,function(){logger.info("Started Server at "+process.env.API_NAME+" api server started. URL: http://"+ipAddress+":"+port+contextPath,{operationName:"createServer"});logger.info("Swagger-ui is available on http://"+ipAddress+":"+port+contextPath+"/docs.",{operationName:"createServer"})})});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAuanMiXSwibmFtZXMiOlsiaXBBZGRyZXNzIiwicG9ydCIsImdsb2JhbCIsImFwaU5hbWUiLCJwcm9jZXNzIiwiZW52IiwiQVBJX05BTUUiLCJhcGlWZXJzaW9uIiwiQVBJX1ZFUlNJT04iLCJtZXRhRGF0YSIsIndpbnN0b24iLCJmb3JtYXQiLCJpbmZvIiwiYXBwbGljYXRpb25OYW1lIiwiYXBwbGljYXRpb25WZXJzaW9uIiwiZW52aXJvbm1lbnQiLCJFTlZJUk9OTUVOVCIsImxvZ2dlciIsImNyZWF0ZUxvZ2dlciIsImxldmVsIiwiTE9HX0xFVkVMIiwidHJhbnNwb3J0cyIsIkNvbnNvbGUiLCJuYW1lIiwianNvbiIsImNvbWJpbmUiLCJ0aW1lc3RhbXAiLCJleGl0Iiwib3BlcmF0aW9uTmFtZSIsImh0dHBTdGF0dXNDb2RlcyIsInNlcnZpY2VVcHRpbWUiLCJEYXRlIiwiY2VydGlmaWNhdGUiLCJKV1RfQ0VSVElGSUNBVEUiLCJhcHAiLCJvcHRpb25zIiwic3dhZ2dlclVpIiwicGF0aCIsImpvaW4iLCJfX2Rpcm5hbWUiLCJjb250cm9sbGVycyIsInVzZVN0dWJzIiwiU1RVQiIsInNwZWMiLCJmcyIsInJlYWRGaWxlU3luYyIsInN3YWdnZXJEb2MiLCJqc3lhbWwiLCJzYWZlTG9hZCIsImNvbnRleHRQYXRoIiwiQ09OVEVYVF9QQVRIIiwidWlPcHRpb25zIiwiYXBpRG9jcyIsInN3YWdnZXJUb29scyIsImluaXRpYWxpemVNaWRkbGV3YXJlIiwibWlkZGxld2FyZSIsInVzZSIsInN3YWdnZXJNZXRhZGF0YSIsInN3YWdnZXJWYWxpZGF0b3IiLCJzd2FnZ2VyUm91dGVyIiwiZXJyIiwicmVxIiwicmVzIiwibmV4dCIsInRyYW5zYWN0aW9uSWQiLCJjb3JyZWxhdGlvbklkIiwic3dhZ2dlciIsInBhcmFtcyIsInZhbHVlIiwic2V0SGVhZGVyIiwic3RhdHVzQ29kZSIsIkJBRF9SRVFVRVNUIiwibG9nIiwib3BlcmF0aW9uSWQiLCJzdGFja1RyYWNlIiwiZXJyb3IiLCJjb2RlIiwibWVzc2FnZSIsImZpZWxkcyIsImVuZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJodHRwIiwiY3JlYXRlU2VydmVyIiwibGlzdGVuIl0sIm1hcHBpbmdzIjoiQUFBQSxhLHdLQUVBLDhDQUNBLGtEQUNBLGtEQUNBLG1FQUNBLHVEQUNBLG9FQUNBLHdEQUNBLGtEQUdBLHNDQUNBLHNDQUNBLHdEQTZEQSxzQkFoRUE7QUFLQTt5QkFDd0IsaUMsQ0FBbkJBLFMsc0JBQUFBLFMsQ0FBV0MsSSxzQkFBQUEsSSxDQUVoQjtBQUNBQyxNQUFNLENBQUNDLE9BQVAsQ0FBaUJDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxRQUE3QixDQUNBSixNQUFNLENBQUNLLFVBQVAsQ0FBb0JILE9BQU8sQ0FBQ0MsR0FBUixDQUFZRyxXQUFoQyxDQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxHQUFNQyxDQUFBQSxRQUFRLENBQUdDLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLFNBQUFDLElBQUksQ0FBSSxDQUN2Q0EsSUFBSSxDQUFDQyxlQUFMLENBQXVCWCxNQUFNLENBQUNDLE9BQTlCLENBQ0FTLElBQUksQ0FBQ0Usa0JBQUwsQ0FBMEJaLE1BQU0sQ0FBQ0ssVUFBakMsQ0FDQUssSUFBSSxDQUFDRyxXQUFMLENBQW1CWCxPQUFPLENBQUNDLEdBQVIsQ0FBWVcsV0FBL0IsQ0FDQSxNQUFPSixDQUFBQSxJQUNQLENBTGdCLENBQWpCLENBUUEsR0FBTUssQ0FBQUEsTUFBTSxDQUFHUCxPQUFPLENBQUNRLFlBQVIsQ0FBcUIsQ0FDbkNDLEtBQUssQ0FBRWYsT0FBTyxDQUFDQyxHQUFSLENBQVllLFNBRGdCLENBRW5DQyxVQUFVLENBQUUsQ0FDWDtBQUNBLEdBQUlYLENBQUFBLE9BQU8sQ0FBQ1csVUFBUixDQUFtQkMsT0FBdkIsQ0FBK0IsQ0FDOUJDLElBQUksQ0FBRSxTQUR3QixDQUU5QkMsSUFBSSxDQUFFLElBRndCLENBRzlCTCxLQUFLLENBQUVmLE9BQU8sQ0FBQ0MsR0FBUixDQUFZZSxT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RixDQUFvRyxDQUFDckIsYUFBYSxDQUFFLGNBQWhCLENBQXBHLENBQ0EsQ0FIRCxDQUtBLENBL0NEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcclxuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xyXG5pbXBvcnQgKiBhcyBodHRwIGZyb20gXCJodHRwXCI7XHJcbmltcG9ydCAqIGFzIHN3YWdnZXJUb29scyBmcm9tIFwic3dhZ2dlci10b29sc1wiO1xyXG5pbXBvcnQgKiBhcyAganN5YW1sIGZyb20gXCJqcy15YW1sXCI7XHJcbmltcG9ydCAqIGFzIGh0dHBTdGF0dXNDb2RlcyBmcm9tIFwiaHR0cC1zdGF0dXNcIjtcclxuaW1wb3J0ICogYXMgd2luc3RvbiBmcm9tIFwid2luc3RvblwiO1xyXG5pbXBvcnQgdXVpZCBmcm9tIFwidXVpZC92NFwiO1xyXG5cclxuLy8gR2V0IGlwIGFkZHJlc3MgYW5kIHBvcnQgZm9yIGNsaWVudCBkZXRhaWxzXHJcbmltcG9ydCB7Z2V0SXBBZGRyZXNzQW5kUG9ydH0gZnJvbSBcIi4vdXRpbHMvaGVscGVyXCI7XHJcbmltcG9ydCB7Y2hlY2tDb25maWd1cmF0aW9ufSBmcm9tIFwiLi91dGlscy9jb25maWdcIjtcclxuaW1wb3J0IGNvbm5lY3QgZnJvbSBcImNvbm5lY3RcIjtcclxuXHJcbi8vZ2V0IGlwQWRkcmVzcyBhbmQgcG9ydFxyXG5sZXQge2lwQWRkcmVzcywgcG9ydH0gPSBnZXRJcEFkZHJlc3NBbmRQb3J0KCk7XHJcblxyXG4vLyBTZXQgQXBwIE5hbWVcclxuZ2xvYmFsLmFwaU5hbWUgPSBwcm9jZXNzLmVudi5BUElfTkFNRTtcclxuZ2xvYmFsLmFwaVZlcnNpb24gPSBwcm9jZXNzLmVudi5BUElfVkVSU0lPTjtcclxuXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4vL1xyXG4vLyBTZXQgdXAgTG9nZ2VyXHJcbi8vXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5cclxuY29uc3QgbWV0YURhdGEgPSB3aW5zdG9uLmZvcm1hdChpbmZvID0+IHtcclxuXHRpbmZvLmFwcGxpY2F0aW9uTmFtZSA9IGdsb2JhbC5hcGlOYW1lO1xyXG5cdGluZm8uYXBwbGljYXRpb25WZXJzaW9uID0gZ2xvYmFsLmFwaVZlcnNpb247XHJcblx0aW5mby5lbnZpcm9ubWVudCA9IHByb2Nlc3MuZW52LkVOVklST05NRU5UO1xyXG5cdHJldHVybiBpbmZvO1xyXG59KTtcclxuXHJcblxyXG5jb25zdCBsb2dnZXIgPSB3aW5zdG9uLmNyZWF0ZUxvZ2dlcih7XHJcblx0bGV2ZWw6IHByb2Nlc3MuZW52LkxPR19MRVZFTCxcclxuXHR0cmFuc3BvcnRzOiBbXHJcblx0XHQvLyBMb2cgdG8gY29uc29sZVxyXG5cdFx0bmV3IHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKHtcclxuXHRcdFx0bmFtZTogXCJjb25zb2xlXCIsXHJcblx0XHRcdGpzb246IHRydWUsXHJcblx0XHRcdGxldmVsOiBwcm9jZXNzLmVudi5MT0dfTEVWRUxcclxuXHRcdH0pXHJcblx0XSxcclxuXHRmb3JtYXQ6IHdpbnN0b24uZm9ybWF0LmNvbWJpbmUoXHJcblx0XHR3aW5zdG9uLmZvcm1hdC50aW1lc3RhbXAoKSxcclxuXHRcdG1ldGFEYXRhKCksXHJcblx0XHR3aW5zdG9uLmZvcm1hdC5qc29uKClcclxuXHQpXHJcbn0pO1xyXG5cclxuZ2xvYmFsLmxvZ2dlciA9IGxvZ2dlcjtcclxuXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4vL1xyXG4vLyBDaGVjayBjb25maWd1cmF0aW9uIGJlZm9yZSBzdGFydGluZyB0aGUgc2VydmVyXHJcbi8vXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5cclxuXHJcbmlmICghY2hlY2tDb25maWd1cmF0aW9uKCkpIHtcclxuXHRwcm9jZXNzLmV4aXQoMSk7XHJcbn0gZWxzZSB7XHJcblx0Z2xvYmFsLmxvZ2dlci5pbmZvKFwiQWxsIGNvbmZpZ3VyYXRpb25zIGFyZSBhdmFpbGFibGUgdG8gc3RhcnQgdGhlIHNlcnZlclwiLCB7b3BlcmF0aW9uTmFtZTogXCJjcmVhdGVTZXJ2ZXJcIn0pO1xyXG59XHJcblxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuLy9cclxuLy8gQ3JlYXRlIGRhdGFiYXNlIGNvbm5lY3Rpb25cclxuLy9cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcblxyXG5pbXBvcnQgXCIuL2RhdGFiYXNlXCI7XHJcblxyXG5cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbi8vXHJcbi8vIFNldHVwIGdsb2JhbCB2YXJpYWJsZXMgZm9yIHRoZSBlbnRpcmUgYXBwbGljYXRpb25cclxuLy9cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcblxyXG5nbG9iYWwuaHR0cFN0YXR1c0NvZGVzID0gaHR0cFN0YXR1c0NvZGVzO1xyXG5nbG9iYWwuc2VydmljZVVwdGltZSA9IG5ldyBEYXRlKCk7XHJcbmdsb2JhbC5jZXJ0aWZpY2F0ZSA9IHByb2Nlc3MuZW52LkpXVF9DRVJUSUZJQ0FURTtcclxuXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4vL1xyXG4vLyBTdGFydCBTZXJ2ZXJcclxuLy9cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcblxyXG5jb25zdCBhcHAgPSBjb25uZWN0KCk7XHJcblxyXG4vLyBzd2FnZ2VyUm91dGVyIGNvbmZpZ3VyYXRpb25cclxuY29uc3Qgb3B0aW9ucyA9IHtcclxuXHRzd2FnZ2VyVWk6IHBhdGguam9pbihfX2Rpcm5hbWUsIFwiL3N3YWdnZXIuanNvblwiKSxcclxuXHRjb250cm9sbGVyczogcGF0aC5qb2luKF9fZGlybmFtZSwgXCIuL2NvbnRyb2xsZXJzXCIpLFxyXG5cdHVzZVN0dWJzOiBwcm9jZXNzLmVudi5TVFVCXHJcbn07XHJcblxyXG4vLyBUaGUgU3dhZ2dlciBkb2N1bWVudCAocmVxdWlyZSBpdCwgYnVpbGQgaXQgcHJvZ3JhbW1hdGljYWxseSwgZmV0Y2ggaXQgZnJvbSBhIFVSTCwgLi4uKVxyXG5jb25zdCBzcGVjID0gZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbihfX2Rpcm5hbWUsIFwiYXBpL3N3YWdnZXIueWFtbFwiKSwgXCJ1dGY4XCIpO1xyXG5cclxuY29uc3Qgc3dhZ2dlckRvYyA9IGpzeWFtbC5zYWZlTG9hZChzcGVjKTtcclxuXHJcbmxldCBjb250ZXh0UGF0aCA9IHByb2Nlc3MuZW52LkNPTlRFWFRfUEFUSDtcclxuXHJcbmxldCB1aU9wdGlvbnMgPSB7XHJcblx0YXBpRG9jczogY29udGV4dFBhdGggKyBcIi9zd2FnZ2VyXCIsXHJcblx0c3dhZ2dlclVpOiBjb250ZXh0UGF0aCArIFwiL2RvY3NcIlxyXG59O1xyXG5cclxuLy8gSW5pdGlhbGl6ZSB0aGUgU3dhZ2dlciBtaWRkbGV3YXJlXHJcbnN3YWdnZXJUb29scy5pbml0aWFsaXplTWlkZGxld2FyZShzd2FnZ2VyRG9jLCAobWlkZGxld2FyZSkgPT4ge1xyXG5cclxuXHQvLyBJbnRlcnByZXQgU3dhZ2dlciByZXNvdXJjZXMgYW5kIGF0dGFjaCBtZXRhZGF0YSB0byByZXF1ZXN0IC0gbXVzdCBiZSBmaXJzdCBpbiBzd2FnZ2VyLXRvb2xzIG1pZGRsZXdhcmUgY2hhaW5cclxuXHRhcHAudXNlKG1pZGRsZXdhcmUuc3dhZ2dlck1ldGFkYXRhKCkpO1xyXG5cclxuXHQvLyBWYWxpZGF0ZSBTd2FnZ2VyIHJlcXVlc3RzXHJcblx0YXBwLnVzZShtaWRkbGV3YXJlLnN3YWdnZXJWYWxpZGF0b3IoKSk7XHJcblxyXG5cdC8vIFJvdXRlIHZhbGlkYXRlZCByZXF1ZXN0cyB0byBhcHByb3ByaWF0ZSBjb250cm9sbGVyXHJcblx0YXBwLnVzZShtaWRkbGV3YXJlLnN3YWdnZXJSb3V0ZXIob3B0aW9ucykpO1xyXG5cclxuXHQvLyBTZXJ2ZSB0aGUgU3dhZ2dlciBkb2N1bWVudHMgYW5kIFN3YWdnZXIgVUlcclxuXHRhcHAudXNlKG1pZGRsZXdhcmUuc3dhZ2dlclVpKHVpT3B0aW9ucykpO1xyXG5cclxuXHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcclxuXHRhcHAudXNlKGZ1bmN0aW9uIChlcnIsIHJlcSwgcmVzLCBuZXh0KSB7XHJcblx0XHRpZiAoZXJyKSB7XHJcblx0XHRcdGxldCB0cmFuc2FjdGlvbklkID0gdXVpZCgpO1xyXG5cdFx0XHRsZXQgY29ycmVsYXRpb25JZDtcclxuXHRcdFx0aWYgKHJlcS5zd2FnZ2VyLnBhcmFtc1tcImNvcnJlbGF0aW9uSWRcIl0pIHtcclxuXHRcdFx0XHRjb3JyZWxhdGlvbklkID0gcmVxLnN3YWdnZXIucGFyYW1zW1wiY29ycmVsYXRpb25JZFwiXS52YWx1ZTtcclxuXHRcdFx0XHRyZXMuc2V0SGVhZGVyKFwiY29ycmVsYXRpb25JZFwiLCBjb3JyZWxhdGlvbklkID8gY29ycmVsYXRpb25JZCA6IFwiXCIpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJlcy5zdGF0dXNDb2RlID0gaHR0cFN0YXR1c0NvZGVzLkJBRF9SRVFVRVNUO1xyXG5cdFx0XHRyZXMuc2V0SGVhZGVyKFwidHJhbnNhY3Rpb25JZFwiLCB0cmFuc2FjdGlvbklkKTtcclxuXHRcdFx0cmVzLnNldEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XHJcblx0XHRcdGxvZ2dlci5sb2coXCJlcnJvclwiLCBcIklucHV0IHJlcXVlc3QgdmFsaWRhdGlvbiBmYWlsZWRcIiwge1xyXG5cdFx0XHRcdG9wZXJhdGlvbklkOiBcImRlZmF1bHRTZXJ2ZXJFcnJvclwiLFxyXG5cdFx0XHRcdHRyYW5zYWN0aW9uSWQsXHJcblx0XHRcdFx0Y29ycmVsYXRpb25JZCxcclxuXHRcdFx0XHRzdGFja1RyYWNlOiBlcnJcclxuXHRcdFx0fSk7XHJcblx0XHRcdGNvbnN0IGVycm9yID0ge1xyXG5cdFx0XHRcdGNvZGU6IDEwMDAxLFxyXG5cdFx0XHRcdG1lc3NhZ2U6IGVyci5tZXNzYWdlLFxyXG5cdFx0XHRcdGZpZWxkczogW11cclxuXHRcdFx0fTtcclxuXHRcdFx0cmVzLmVuZChKU09OLnN0cmluZ2lmeShlcnJvcikpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyBTdGFydCB0aGUgc2VydmVyXHJcblx0aHR0cC5jcmVhdGVTZXJ2ZXIoYXBwKS5saXN0ZW4ocG9ydCwgKCkgPT4ge1xyXG5cdFx0bG9nZ2VyLmluZm8oXCJTdGFydGVkIFNlcnZlciBhdCBcIiArIHByb2Nlc3MuZW52LkFQSV9OQU1FICsgXCIgYXBpIHNlcnZlciBzdGFydGVkLiBVUkw6IGh0dHA6Ly9cIiArIGlwQWRkcmVzcyArIFwiOlwiICsgcG9ydCArIGNvbnRleHRQYXRoLCB7b3BlcmF0aW9uTmFtZTogXCJjcmVhdGVTZXJ2ZXJcIn0pO1xyXG5cdFx0bG9nZ2VyLmluZm8oXCJTd2FnZ2VyLXVpIGlzIGF2YWlsYWJsZSBvbiBodHRwOi8vXCIgKyBpcEFkZHJlc3MgKyBcIjpcIiArIHBvcnQgKyBjb250ZXh0UGF0aCArIFwiL2RvY3MuXCIsIHtvcGVyYXRpb25OYW1lOiBcImNyZWF0ZVNlcnZlclwifSk7XHJcblx0fSk7XHJcblxyXG59KTtcclxuIl19